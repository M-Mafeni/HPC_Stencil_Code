\documentclass{article}
\usepackage{geometry}
\usepackage{tabularx}
 \geometry{
 a4paper,
 margin = 1in,
 bottom = 1in
 }
\title{Serial Optimisation Report}
\author{Michael Mafeni mm17291}
\date{}
\begin{document}
    \maketitle
    \newpage
    \section{Optimisations used}
        Note: all times quoted are for the 1024 x 1024 image
        \paragraph{}
        In order to increase the performance of the stencil code given, I first used gprof to see where most of the runtime was going. I found that 99\% of the time was being spent in the stencil function. However, Before I began to optimise the code, I first optimised the compiler. I did this by using the many optimisation flags available the times that I got can be found in the table below. It ran fastest with the -Ofast flag at 1.8 seconds.
        \paragraph{}
        After I had optimised the compiler, I had begun to optimise the code. The first thing I noticed was the order of iteration. It was in a column major layout which didn't match the memory layout so I switched the for loops around in order to rectify this. This brought the runtime down to 0.67 seconds on gcc 9. On the Intel Compiler, this was 0.18 seconds. I then optimised the code by reducing the amount of operations it was doing. I stored repeatwd values in local variables and factorised the algorithm so it was doing less multiplication. Finally I noticed that the image was being stored as a 2d array of Doubles where a 2d array of floats would suffice as you did not need that much precision. This brought it down to 0.10 seconds.
    \section{Comparisons of optimised vs unoptimsed code}
    Below are the times recorded for running the 4096 x 4096 stencil image with the optimised vs unoptimised code against all gcc compiler flags:
    % Table generated by Excel2LaTeX from sheet 'Sheet1'
        \begin{table}[htbp]
        \centering
        \caption{List of Runtimes on the GCC 9.0 using different flags}
        \begin{tabular}{|l|r|r|r|r|}
        \hline
        Flags & Unoptimised Code Runtime/s & Optimised code Runtime/s & Unoptimised Speedup & Optimised Speedup \\
        \hline
        O0    & 125.08 & 34.61 & 1     & 1 \\
        \hline
        O1    & 37.74 & 6.37  & 3.31  & 5.43 \\
        \hline
        O2    & 37.18 & 6.27  & 3.36  & 5.52 \\
        \hline
        O3    & 81.8  & 3.1   & 1.53  & 11.16 \\
        \hline
        Ofast & 35.8  & 3.13  & 3.49  & 11.06 \\
        \hline
        % Ofast -mtune=native & 35.78 & 3.46  & 3.5   & 10 \\
        \end{tabular}%
        \label{tab:addlabel}%
        \end{table}%

            % \begin{center}
            % \begin{tabularx}{0.8\textwidth}
            % {
            %     |>{\centering\arraybackslash}X
            %     |>{\centering\arraybackslash}X
            %     |>{\centering\arraybackslash}X
            %     |>{\centering\arraybackslash}X
            %     |>{\centering\arraybackslash}X|
            %     }
            %     \hline
            %     Flags & Unoptimised Code Runtime/s & Optimised code Runtime/s & Unoptimised Speedup & Optimised Speedup \\
            %     \hline
            %     -O0 & 130.05 & 36.52 & 1.0x  & 1.0x\\
            %     \hline
            %     -O1 & 38.85 & 8.64 & 3.35x & 4.23x\\
            %     \hline
            %     -O2 & 37.11 & 6.16 & 3.50x & 5.93x\\
            %     \hline
            %     -O3 & 37.06 & 3.47 & 3.51x & 10.52x\\
            %     \hline
            %     -Ofast & 35.87 & 3.47 & 3.63x & 10.52x\\
            %     \hline
            %     -Ofast â€“mtune=native & 35.80 & 3.47 & 3.63 & 10.32x \\
            %     \hline
            % \end{tabularx}
            % \end{center}

    As we can see from the table above, the rate of change for both decreases rapidly. This is because there's only so much optimisation that the compiler can do. I also tested this code on the Intel C Compiler and these were the results:
    % Table generated by Excel2LaTeX from sheet 'Sheet1'
    \begin{table}[htbp]
      \centering
      \caption{List of Runtimes on the Intel Compiler using different flags}
        \begin{tabular}{|l|r|r|r|r|}
        \hline
        Flags & Unoptimised Code Runtime/s & Optimised code Runtime/s & Unoptimised Speedup & Optimised Speedup \\
        \hline
        O0    & 133.27 & 35.84 & 1     & 1 \\
        \hline
        O1    & 37.34 & 6.07  & 3.57  & 5.9 \\
        \hline
        O2    & 28.77 & 3.03  & 4.63  & 11.83 \\
        \hline
        O3    & 28.77 & 3.02  & 4.63  & 11.87 \\
        \hline
        Ofast & 5.84  & 3.01  & 22.82 & 11.91 \\
        \hline
        fast  & 5.76  & 2.97  & 23.14 & 12.07 \\
        \hline
        \end{tabular}%
      \label{tab:addlabel}%
    \end{table}%
\nocite{*}
\bibliographystyle{plain}
\bibliography{test}
\end{document}
